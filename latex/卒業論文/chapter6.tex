\chapter{計算実験}\label{computational_result}
\section{実験環境}
実験に用いるプログラムはC++を用いて実装し, 計算機はプロセッサ 1.4GHz Intel Core i5, メモリ 16GB 2133 MHz LPDDR3のmacOSを搭載したものを使用した. 探索における最適なサービス開始時刻を決定する際のLPソルバーとしては, Gurobi Optimizer (ver 9.0.0)を使用した.

\section{問題例の作成方法}
DARPでは多くの既存研究があるが, 本研究では時間枠及び乗車時間に対して区分線形で凸のペナルティ関数で与えている. このような問題設定のインスタンスは存在していないため, ベンチマークとしてよく使用されるCordeauらによって提供されている\cite{tabu}インスタンスに修正を加えて計算実験を行う. 修正方法を以下に示す.

時間枠に関しては, サービス開始可能時刻を$e$, サービス開始最遅時間を$l$とすると, 0以上$e$以下に対しては傾き-1, $e$から$l$に対しては値が0, $l$以上に対しては傾きが1となるような, 区分数が3のペナルティ関数を作成する. この修正作業を全てのリクエストに対して行う. 乗車時間に関しては, 乗車時間の閾値を$L$とすると, 0以上$L$以下に対しては値が0, $L$以上に対しては傾きが1となるような区分数2のペナルティ関数を作成する. この修正作業を全てのリクエストペアに対して行う.
\section{インスタンスについて}
計算実験に使用するインスタンスは, 以下の特徴を持つ.
\begin{enumerate}
 \item 訪問点におけるサービス時間$d$を10とする.
 \item 乗降人数は1人とする.
 \item 訪問点$v_i$と$v_j$間の距離$c_{ij}$と時間$t_{ij}$は, 2つの頂点のユークリッド距離とする.
 \item 乗車時間の閾値(最大乗車時間)を90とする.
 \item 車両の最大容量を6人とする.
 \item それぞれの車両のルートの最大の長さを480とする.
\end{enumerate}
以上の特徴を持つリクエスト数24から144のインスタンスを使用して計算実験を行った.
\section{実験結果}
ここでは, 提案手法について行った計算実験の結果を示す.
顧客数と車両数がそれぞれ同じであるインスタンスが2つずつあるため, 添字$a,b$で区別する.

\subsection{挿入近傍と交換近傍の比較}
\label{sec:insert}
局所探索におけるルート間の近傍操作として挿入近傍と交換近傍の比較を行った.
目的関数におけるペナルティ係数$\alpha,\beta$は1とする.
試行回数を$10^4$回としたときの計算結果を表\ref{insert}に示す.
表における最良値は, ルートの総距離とペナルティの和を示す.


ほぼ全てのインスタンスにおいて, 挿入近傍による値のほうが交換近傍による値よりも良い性能であることが確認でき, 平均で6.5\%良い性能であることが確認できた. 一方で, 計算時間に関しては交換近傍のほうが平均で3.5\%早いことがわかった.
\subsection{既存研究との比較}
\label{sec:cordeau}
本研究での提案手法で, 時間枠と乗車時間のペナルティの値を大きくすることで, 既存研究との計算結果を比較することができる. \ref{sec:insert}で挿入近傍のほうが良い解を得られることが確認できたため, 挿入近傍を用いて出力した解とCordeauらによって示された最良値を比較する. また, 目的関数におけるペナルティを$\alpha=1,\beta=500$とする.
Cordeauらによって示された最良値は試行回数が$10^5$回の値であるため, 同様に$10^5$回の試行を行い, 結果を比較した. 計算実験の値と最良解との相違を表\ref{cordeau}に示す. 表\ref{cordeau}のBest Known Scoreの数字は, 試行回数が$10^3$回と$10^4$回のときのルートの総距離である. 最良値は, ルートの総距離を示す.

複数のインスタンスでペナルティの値が0である解を得ることができ, Cordeauらが示した最良解との比較を行うことができた.
規模の小さいインスタンス(r1a,r2a,r1b,r2b)に対しては, 最良解との相違が30\%程度の解を得ることができた. 一方, 規模の大きいインスタンスに対しては, あまり良い結果が得られなかった. これは, 局所最適解を得るための十分な試行回数を行うことができなかったことが理由と考えられる. また, ペナルティに対する係数を$\beta=500$と大きくしているので, ルートの総距離についてはあまり最小化されなかったと考えられる.
\subsection{目的関数の係数の違いによる計算結果}
本研究では, 目的関数をルートの総距離と顧客の不満度合いの重み付き和として, その最小化を考えている. 2つの係数$\alpha, \beta$の値を変化させた際の計算結果を表\ref{beta}に示す. 表における最良値は, ルートの総距離を示す.

平均を見ると, 係数$\beta$が小さいときは出力されたルートの長さは小さく, ペナルティの値が大きいことがわかる. 一方, 係数$\beta$が大きいときは出力されるルートの長さは大きいものの, ペナルティの値は小さいことがわかる. これらより, 目的関数における定数$\alpha$, $\beta$の値を変えることでルートの長さとペナルティの重要度によって出力するルートを変化させることができることが確認できた.

\subsection{車両数を減らした計算結果}
実社会の乗合サービスにおける車両数を減らすことは, 運用コストの削減に大きくつながると予想される. そこで, Cordeauらによって提供されているインスタンスの規模の小さいものに対して, 車両数を1台少なくして局所最適解を出力したものと, 車両台数に変化を加えないもので比較を行った. 目的関数におけるペナルティを$\alpha=1,\beta=1$とし, \ref{sec:cordeau}と同様に$10^5$回の試行を行った. 計算実験の値を表\ref{m-1}に示す. 表における最良値は, ルートの総距離を示す.

実験を行った6つのインスタンス全てで, ペナルティが発生しているものの実行可能なルートを出力できていることを確認できた. 平均すると解の精度は4\%程度悪くなり, ペナルティ値は増加しているものの, 車両数を削減できているため, サービス自体のコストを削減することが可能であると考えられる.




\begin{table}[]
\tabcolsep = 12pt
\renewcommand{\arraystretch}{0.8}
\caption{挿入近傍と交換近傍の比較}
\label{insert}
\begin{tabular}{ccccrcr}
\hline
    & \multicolumn{2}{c}{size} & \multicolumn{2}{c}{挿入近傍}                          & \multicolumn{2}{c}{交換近傍}                         \\ \cline{2-7}
問題例 & 顧客数           &  車両数          & 最良値                      & \multicolumn{1}{c}{計算時間(分)} & 最良値                      & \multicolumn{1}{c}{計算時間(分)} \\ \cline{2-7}
r1a & 24          & 3          & \multicolumn{1}{r}{216.00} & 2.14                     & \multicolumn{1}{r}{233.37} & 1.72                    \\
r2a & 48          & 5          & \multicolumn{1}{r}{514.50}  & 2.93                      & \multicolumn{1}{r}{566.30}  & 2.81                     \\
r3a & 72         & 7          & \multicolumn{1}{r}{960.47} & 4.91                   & \multicolumn{1}{r}{959.99} & 4.74                  \\
r1b & 24          & 3          & \multicolumn{1}{r}{195.60} & 2.41                     & \multicolumn{1}{r}{209.95} & 2.48                     \\
r2b & 48          & 5          & \multicolumn{1}{r}{437.56} & 3.34                     & \multicolumn{1}{r}{453.13} & 3.24                     \\
r3b & 72         & 7          & \multicolumn{1}{r}{921.74} & 4.65                  & \multicolumn{1}{r}{1031.66} & 4.71                \\
& \multicolumn{1}{c}{} & \multicolumn{1}{l}{} &                          &                           &                         &                               \\
 \multicolumn{1}{c}{average} & \multicolumn{1}{c}{} &                          &   \multicolumn{1}{r}{540.98}                        &    \multicolumn{1}{r}{3.4}                      &  \multicolumn{1}{r}{575.73}  &     \multicolumn{1}{r}{3.28}                        \\
\hline
\end{tabular}
\end{table}


\begin{landscape}
\begin{table}[]
\tabcolsep = 19pt
\renewcommand{\arraystretch}{0.8}
\caption{Best Known Scoreとの比較}
\label{cordeau}
\begin{tabular}{ccclllll}
\hline
        & \multicolumn{2}{c}{size}                    & \multicolumn{3}{c}{本研究}                                                        & \multicolumn{2}{c}{Besk Known Score}                       \\ \cline{2-8}
問題例     & 顧客数                    & 車両数                   & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{GAP(\%)} & \multicolumn{1}{c}{1000} & \multicolumn{1}{c}{10000} \\ \cline{2-8}
r1a     & 24                   & 3                    & \multicolumn{1}{r}{212.49}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{11.8}   & \multicolumn{1}{r}{190.79}    & \multicolumn{1}{r}{190.02}     \\
r2a     & 48                   & 3                    & \multicolumn{1}{r}{386.03}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{27.7}   & \multicolumn{1}{r}{302.08}    & \multicolumn{1}{r}{302.08}     \\
r3a     & 72                   & 7                   & \multicolumn{1}{r}{776.31}    & \multicolumn{1}{r}{0.56}     & \multicolumn{1}{r}{45.8}   & \multicolumn{1}{r}{532.08}    & \multicolumn{1}{r}{532.08}     \\
r4a     & 96                   & 9                  & \multicolumn{1}{r}{1005.17}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{75.4}   & \multicolumn{1}{r}{572.68}    & \multicolumn{1}{r}{572.68}     \\
r5a     & 120                 & 11                   & \multicolumn{1}{r}{1077.68}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{69.1}   & \multicolumn{1}{r}{636.97}    & \multicolumn{1}{r}{636.97}     \\
r6a     & 144                  & 13                    & \multicolumn{1}{r}{1506.35}    & \multicolumn{1}{r}{9.56}     & \multicolumn{1}{r}{87.9}   & \multicolumn{1}{r}{801.40}    & \multicolumn{1}{r}{801.40}     \\
r1b    & 24                 & 3                    & \multicolumn{1}{r}{195.60}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{18.9}   & \multicolumn{1}{r}{164.72}    & \multicolumn{1}{r}{164.46}     \\
r2b     & 48                 & 5                  & \multicolumn{1}{r}{388.43}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{31.0}   & \multicolumn{1}{r}{301.28}    & \multicolumn{1}{r}{296.06}     \\
r3b     & 72                  &7                   & \multicolumn{1}{r}{777.09}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{57.5}   & \multicolumn{1}{r}{498.20}    & \multicolumn{1}{r}{493.30}     \\
r4b     & 96                 & 9                   & \multicolumn{1}{r}{973.73}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{81.6}   & \multicolumn{1}{r}{548.89}    & \multicolumn{1}{r}{535.90}     \\
r5b     & 120                 & 11                   & \multicolumn{1}{r}{976.45}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{65.5}   & \multicolumn{1}{r}{592.65}    & \multicolumn{1}{r}{589.74}     \\
r6b     & 144               & 13                   & \multicolumn{1}{r}{1317.47}    & \multicolumn{1}{r}{0.00}     & \multicolumn{1}{r}{77.1}   & \multicolumn{1}{r}{766.55}    & \multicolumn{1}{r}{743.60}     \\
        & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} &                          &                           &                         &                          &                           \\
average & \multicolumn{1}{c}{} & \multicolumn{1}{l}{} &\multicolumn{1}{r}{796.86}   &     \multicolumn{1}{r}{0.84}                        &  \multicolumn{1}{r}{51.8}                        &       \multicolumn{1}{r}{524.91}                    &       \multicolumn{1}{r}{515.38}                     \\ \hline
\end{tabular}
\end{table}
\end{landscape}


\begin{landscape}
  \begin{table}[]
  \caption{係数$\beta$を変化させた際の計算結果}
  \label{beta}
  \begin{tabular}{cllrrrrrrrr}
  \hline
  \multicolumn{1}{l}{} & \multicolumn{2}{c}{size}                          & \multicolumn{2}{c}{\beta=1}                               & \multicolumn{2}{c}{\beta=10}                              & \multicolumn{2}{c}{\beta=50}                              & \multicolumn{2}{c}{\beta=500}                             \\ \cline{2-11}
  問題例                  & \multicolumn{1}{r}{顧客数} & \multicolumn{1}{r}{車両数} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} \\ \cline{2-11}
  r1a                  & \multicolumn{1}{c}{24}  & \multicolumn{1}{c}{3}   & 202.19                        & 1.07                         & 208.99                       & 0.00                      & 208.99                        & 0.00                        & 212.49                        & 0.00                        \\
  r2a                  & \multicolumn{1}{c}{48}  & \multicolumn{1}{c}{5}   & 424.79                        & 1.67                        & 391.61                      & 0.02                        & 386.03                        & 0.00                        & 386.03                        & 0.0                         \\
  r3a                  & \multicolumn{1}{c}{72}  & \multicolumn{1}{c}{7}   & 708.97                        & 17.18                         & 803.64                        & 0.00                       & 763.27                        & 3.50                        & 776.31                        & 0.56                         \\
  r4a                  & \multicolumn{1}{c}{96}  & \multicolumn{1}{c}{9}   & 911.66                        & 14.99                      & 928.49                        & 0.00                        & 1005.17                       & 0.00                     & 1005.17                        & 0.00                        \\
  r5a                  & \multicolumn{1}{c}{120}  & \multicolumn{1}{c}{11}   & 1038.52                       & 19.37                      & 1094.43                        & 0.00                        & 1077.49                       & 0.00                        & 1077.68                        & 0.0                         \\
  r6a                  & \multicolumn{1}{c}{144}  & \multicolumn{1}{c}{13}   & 1350.81                       & 22.38                         & 1428.04                        & 49.88                        & 1494.52                        & 39.64                         & 1506.35                        & 9.56                         \\
  r1b                  & \multicolumn{1}{c}{24}  & \multicolumn{1}{c}{3}   & 200.74                       & 0.00                      & 197.48                       & 0.00                        & 203.61                        & 0.00                       & 195.6                        & 0.0
                           \\
  r2b                  & \multicolumn{1}{c}{48}  & \multicolumn{1}{c}{5}   & 403.99                        & 1.38                         & 398.94                        & 0.00                        & 386.47                        & 0.00                        & 388.43                        & 0.0                         \\
  r3b                  & \multicolumn{1}{c}{72}  & \multicolumn{1}{c}{7}   & 686.30                & 15.71                        & 752.70                        & 0.14                         & 777.09                        & 0.00                        & 777.09                        & 0.0                         \\
  r4b                  & \multicolumn{1}{c}{96}  & \multicolumn{1}{c}{9}   & 894.65                     & 3.70                    & 919.01                        & 0.00                        & 958.40                        & 0.24                         & 973.73                        & 0.0                         \\
  r5b                  & \multicolumn{1}{c}{120}  & \multicolumn{1}{c}{11}   & 964.83                      & 12.25                         & 1007.51                        & 0.00                       & 976.45                        & 0.00                        & 976.45                       & 0.0                         \\
  r6b                  & \multicolumn{1}{c}{144}  & \multicolumn{1}{c}{13}   & 1264.03                     & 22.45                        & 1297.15                       & 0.34                         & 1314.24                        & 0.00                        & 1317.47                        & 0.0                         \\
                       &                         &                         &                           &                           &                           &                           &                           &                           &                           &                           \\
  average              &                         &                         & 754.29                        & 11.01                         & 785.66                         & 4.19                         & 795.97                         & 3.615                         & 796.86                         & 0.84                        \\ \hline
  \end{tabular}
  \end{table}
\end{landscape}




% \begin{landscape}
\begin{table}[]
% \tabcolsep = 19pt
\renewcommand{\arraystretch}{0.8}
\caption{車両数を減らした際の比較}
\label{m-1}
\begin{tabular}{cl|lll|lll}
\hline
                            & \multicolumn{1}{c|}{}    & \multicolumn{3}{c|}{台数に変化なし}                                               & \multicolumn{3}{c}{1台削除}                                                \\ \hline
問題例                          & \multicolumn{1}{c|}{顧客数} & \multicolumn{1}{c}{車両数} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c|}{ペナルティ値} & \multicolumn{1}{c}{車両数} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} \\ \hline
r1a                         & \multicolumn{1}{r|}{24}  & \multicolumn{1}{r}{3} & \multicolumn{1}{r}{202.19} & \multicolumn{1}{r|}{1.07}  & \multicolumn{1}{r}{2} & \multicolumn{1}{r}{235.23} & \multicolumn{1}{r}{0.44}  \\
r2a                         & \multicolumn{1}{r|}{48}  & \multicolumn{1}{r}{5} & \multicolumn{1}{r}{424.79} & \multicolumn{1}{r|}{1.67}  & \multicolumn{1}{r}{4} & \multicolumn{1}{r}{390.20} & \multicolumn{1}{r}{13.08}  \\
r3a                         & \multicolumn{1}{r|}{72}  & \multicolumn{1}{r}{7} & \multicolumn{1}{r}{708.97} & \multicolumn{1}{r|}{17.18}  & \multicolumn{1}{r}{6} & \multicolumn{1}{r}{749.78} & \multicolumn{1}{r}{45.47}  \\
r1b                       & \multicolumn{1}{r|}{24}  & \multicolumn{1}{r}{3} & \multicolumn{1}{r}{200.74} & \multicolumn{1}{r|}{0.00}  & \multicolumn{1}{r}{2} & \multicolumn{1}{r}{217.61} & \multicolumn{1}{r}{2.40}  \\
r2b                        & \multicolumn{1}{r|}{48}  & \multicolumn{1}{r}{5} & \multicolumn{1}{r}{403.99} & \multicolumn{1}{r|}{1.38}  & \multicolumn{1}{r}{4} & \multicolumn{1}{r}{377.78} & \multicolumn{1}{r}{11.46}  \\
r3b                           & \multicolumn{1}{r|}{72}  & \multicolumn{1}{r}{7} & \multicolumn{1}{r}{686.30} & \multicolumn{1}{r|}{15.71}  & \multicolumn{1}{r}{6} & \multicolumn{1}{r}{707.90} & \multicolumn{1}{r}{27.26}  \\
       &           \multicolumn{1}{l|}{}               &                       &                       &                        &                       &                       &                        \\
\multicolumn{1}{l}{average} & \multicolumn{1}{l|}{}                        &                       & \multicolumn{1}{r}{428.77}                    & \multicolumn{1}{r|}{5.65}                  &                       & \multicolumn{1}{r}{446.41}                   & \multicolumn{1}{r}{16.18}                    \\ \hline
\end{tabular}
\end{table}
% \end{landscape}


% \begin{table}[htbp]
%  \centering
%  \tabcolsep = 40pt
%  \renewcommand{\arraystretch}{0.8}
%  \caption{表の表示例}
%  \label{table12}
%  \begin{tabular}{lrr} \hline
%   問題例 & 挿入近傍 & 計算時間（秒)& 挿入近傍 & 計算時間（秒) \\ \hline
%   instance\_24\_3 &    123 & 10.1 \\
%   c10100 &    456 & 15.2 \\
%   c20100 &    789 & 20.3 \\ \hline
%  \end{tabular}
% \end{table}


% \begin{table*}
%  \centering
%  \tabcolsep = 19pt
%  \renewcommand{\arraystretch}{0.8}
%  \caption{2段組みスタイルにおいて幅の広い表を表示する例}
%  \label{table2}
%  \begin{tabular}{lrrcrr} \hline
%   &\multicolumn{2}{c}{既存手法} && \multicolumn{2}{c}{提案手法}\\ \cline{2-3} \cline{5-6}
%
%   問題例 & 最良値 & 計算時間（秒）&& 最良値 & 計算時間（秒） \\ \hline
%   c05100 &    123 &          10.1 &&    111 &          10.00\\
%   c10100 &    456 &          15.2 &&    432 &          15.0 \\
%   c20100 &    789 &          20.3 &&    765 &          20.00\\ \hline
%  \end{tabular}
% \end{table*}
