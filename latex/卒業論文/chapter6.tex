\chapter{計算実験}\label{computational_result}
\section{実験環境}
実験に用いるプログラムはC++を用いて実装し, 計算機はプロセッサ 1.4 GHz Intel Core i5, メモリ 16 GB 2133 MHz LPDDR3のmacOSを搭載したものを使用した. 探索における最適なサービス開始時刻を決定する際のLPソルバーとしては, Gurobi Optimizer (ver 9.0.0)を使用した.

\section{問題例の作成方法}
DARPでは多くの既存研究があるが, 本研究では時間枠及び乗車時間に対して区分線形で凸のペナルティ関数で与えている. このような問題設定のインスタンスは存在していないため, ベンチマークとしてよく使用されるCordeauらによって提供されている\cite{tabu}インスタンスに修正を加えて計算実験を行う. 修正方法を以下に示す.

時間枠に関しては, サービス開始可能時刻を$e$, サービス開始最遅時間を$l$とすると, 0以上$e$以下に対しては傾き-1, $e$から$l$に対しては値が0, $l$以上に対しては傾きが1となるような, 区分数が3のペナルティ関数を作成する. この修正作業を全てのリクエストに対して行う. 乗車時間に関しては, 乗車時間の閾値を$L$とすると, 0以上$L$以下に対しては値が0, $L$以上に対しては傾きが1となるような区分数2のペナルティ関数を作成する. この修正作業を全てのリクエストペアに対して行う.
\section{インスタンスについて}
計算実験に使用するインスタンスは, 以下の特徴を持つ.
\begin{enumerate}
 \item 訪問点におけるサービス時間$d$を10とする.
 \item 乗降人数は1人とする.
 \item 訪問点$v_i$と$v_j$間の距離$c_{ij}$と時間$t_{ij}$は, 2つの頂点のユークリッド距離とする.
 \item 乗車時間の閾値(最大乗車時間)を90とする.
 \item 車両の最大容量を6人とする.
 \item それぞれの車両のルートの最大の長さを480とする.
\end{enumerate}
以上の特徴を持つリクエスト数24から144のインスタンスを使用して計算実験を行った.
\section{実験結果}
ここでは, 提案手法について行った計算実験の結果を示す.
顧客数と車両数がそれぞれ同じであるインスタンスが2つずつあるため, 添字$a,b$で区別する.

\subsection{挿入近傍と交換近傍の比較}
\label{sec:insert}
局所探索におけるルート間の近傍操作として挿入近傍と交換近傍の比較を行った. また, 挿入近傍と交換近傍を交互に行った際の比較も行った.
目的関数におけるペナルティ係数$\alpha$を1, $\beta$を5とする.
試行回数を$10^4$回としたときの計算結果を表\ref{insert}に示す.
表における最良値は, ルートの総距離とペナルティの和を示す.


6つのインスタンスで比較を行い, 3つのインスタンスでは挿入近傍で最良解を得ることができ, 3つのインスタンスでは2種類の近傍操作を交互に行った際に最良解を得ることができた. 計算時間に関しては, 2種類の近傍操作を交互に行った際は, 他の2種類に比べて約30\%長くなっていることが確認できた.
\subsection{既存研究との比較}
\label{sec:cordeau}
本研究での提案手法で, 時間枠と乗車時間のペナルティの値を大きくすることで, 既存研究との計算結果を比較することができる. \ref{sec:insert}で挿入近傍を用いた際と, 挿入近傍と交換近傍を交互に行った際に良い解を得られることが確認できたため, 2種類の近傍操作を用いて出力した解とCordeauらによって示された最良値を比較する. また, 目的関数におけるペナルティを$\alpha=1, \beta=500$とする. Cordeauらによって示された最良値は試行回数が$10^5$回の値であるため, 同様に$10^5$回の試行を行い, 結果を比較した. 計算実験の値と最良解との相違を表\ref{cordeau}に示す. 最良値は, ルートの総距離を示す.

1つのインスタンス（r6a）を除く全てのインスタンスでペナルティの値が0である解を得ることができ, Cordeauらが示した最良解との比較を行うことができた.
規模の小さいインスタンス(r1a, r2a, r1b, r2b)に対しては, 最良解との相違が30\%程度の解を得ることができた. 一方, 規模の大きいインスタンスに対しては, あまり良い結果が得られなかった. これは, 局所最適解を得るための十分な試行回数を行うことができなかったことが理由と考えられる. また, ペナルティに対する係数を$\beta=500$と大きくしているので, ルートの総距離についてはあまり最小化されなかったと考えられる.
\subsection{目的関数の係数の違いによる計算結果}
本研究では, 目的関数をルートの総距離と顧客の不満度合いの重み付き和として, その最小化を考えている. 2つの係数$\alpha, \beta$の値を変化させた際の計算結果を表\ref{beta}に示す. 近傍操作には挿入近傍を用いた. 表における最良値は, ルートの総距離を示す.

平均を見ると, 係数$\beta$が小さいときは出力されたルートの長さは小さく, ペナルティの値が大きいことがわかる. 一方, 係数$\beta$が大きいときは出力されるルートの長さは大きいものの, ペナルティの値は小さいことがわかる. これらより, 目的関数における定数$\alpha$, $\beta$の値を変えることでルートの長さとペナルティの重要度によって出力するルートを変化させることができることが確認できた.

\subsection{車両数を減らした計算結果}
実社会の乗合サービスにおける車両数を減らすことは, 運用コストの削減に大きくつながると予想される. そこで, Cordeauらによって提供されているインスタンスの規模の小さいものに対して, 車両数を1台少なくして局所最適解を出力したものと, 車両台数に変化を加えないもので比較を行った. 目的関数におけるペナルティを$\alpha=1, \beta=1$とし, \ref{sec:cordeau}と同様に$10^5$回の試行を行った. 計算実験の値を表\ref{m-1}に示す. 近傍操作は挿入近傍を用いた. 表における最良値は, ルートの総距離を示す.

1つのインスタンス（r1a）を除く全てのインスタンスでペナルティの値が増加していることが確認できた. 一方でルートの総距離に関しては, いくつかのインスタンスで良い解を得ることも確認できた. ペナルティ値は増加しているものの, 車両数を削減して実行可能な解を出力できているため, サービス自体のコストを削減することが可能であると考えられる.

\begin{table}[]
  \renewcommand{\arraystretch}{0.8}
  \caption{近傍操作の比較}
  \label{insert}
\begin{tabular}{cccrrrrrr}
\hline
\multicolumn{1}{l}{} & \multicolumn{2}{c}{size} & \multicolumn{2}{c}{挿入近傍}                              & \multicolumn{2}{c}{交換近傍}                              & \multicolumn{2}{c}{2種類を交互}                            \\ \cline{2-9}
問題例                  & 顧客数         & 車両数        & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{計算時間(分)} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{計算時間(分)} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{計算時間(分)} \\ \cline{2-9}
r1a                  & 24          & 3          & 216.00                  & 2.14                        & 233.37                  & 1.72                        & 211.84                  & 2.86                        \\
r2a                  & 48          & 5          & 514.50                  & 2.93                        & 566.30                  & 2.81                        & 558.18                  & 4.07                        \\
r3a                  & 72          & 7          & 960.47                  & 4.91                        & 959.99                  & 4.74                        & 919.01                  & 6.30                        \\
r1b                  & 24          & 3          & 195.60                  & 2.41                        & 209.95                  & 2.48                        & 208.88                  & 2.58                        \\
r2b                  & 48          & 5          & 437.56                  & 3.34                        & 453.13                  & 3.24                        & 432.228                 & 4.37                        \\
r3b                  & 72          & 7          & 921.74                  & 4.65                        & 1031.66                 & 4.71                        & 923.225                 & 6.07                        \\
\multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{}    & \multicolumn{1}{l}{}        & \multicolumn{1}{l}{}    & \multicolumn{1}{l}{}        & \multicolumn{1}{l}{}    & \multicolumn{1}{l}{}        \\
平均                   & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{}    & 3.40                        &                         & 3.28                        &                         & 4.37                        \\ \hline
\end{tabular}
\end{table}




\begin{landscape}
  \begin{table}[]
    \renewcommand{\arraystretch}{0.8}
    \caption{Best Known Scoreとの比較}
    \label{cordeau}
  \begin{tabular}{cccrrrrrrrrr}
  \hline
  \multicolumn{1}{l}{} & \multicolumn{2}{c}{size}                    & \multicolumn{3}{c}{挿入近傍}                                                                 & \multicolumn{3}{c}{挿入近傍と交換近傍絵を交互}                                                             & \multicolumn{2}{l}{本研究での最良値}                          & \multicolumn{1}{c}{Cordeau} \\ \cline{2-12}
  問題例                  & 顧客数                  & 車両数                  & \multicolumn{1}{c}{最良値}     & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{GAP(\%)} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{GAP(\%)} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{l}{GAP(\%)} & \multicolumn{1}{c}{最良値}              \\ \cline{2-12}
  r1a                  & 24                   & 3                    & 212.49                      & 0.00                       & 11.8                        & 208.34                  & 0.00                       & 9.6                         & 208.34                  & 9.6                         & 190.02                               \\
  r2a                  & 48                   & 5                    & 386.03                      & 0.00                       & 27.7                        & 415.57                  & 0.00                       & 37.5                        & 386.03                  & 27.7                        & 302.08                               \\
  r3a                  & 72                   & 7                    & 776.31                      & 0.56                       & 45.8                        & 783.60                  & 0.00                       & 47.8                        & 776.31                  & 45.8                        & 532.08                               \\
  r4a                  & 96                   & 9                    & 1005.17                     & 0.00                       & 75.4                        & 956.48                  & 0.00                       & 67.1                        & 956.48                  & 67.1                        & 572.68                               \\
  r5a                  & 120                  & 11                   & 1077.68                     & 0.00                       & 69.1                        & 1121.34                 & 0.00                       & 76.2                        & 1077.68                 & 69.1                        & 636.97                               \\
  r6a                  & 144                  & 13                   & 1506.35                     & 9.56                       & 87.9                        & 1500.95                 & 9.41                       & 87.1                        & 1500.95                 & 87.1                        & 801.40                               \\
  r1b                  & 24                   & 3                    & 195.60                      & 0.00                       & 18.9                        & 191.00                  & 0.00                       & 16.1                        & 191.00                  & 16.1                        & 164.46                               \\
  r2b                  & 48                   & 5                    & 388.43                      & 0.00                       & 31.0                        & 380.84                  & 0.00                       & 28.3                        & 380.84                  & 28.3                        & 296.06                               \\
  r3b                  & 72                   & 7                    & 777.09                      & 0.00                       & 57.5                        & 713.94                  & 0.00                       & 44.6                        & 713.94                  & 44.6                        & 493.30                               \\
  r4b                  & 96                   & 9                    & 973.73                      & 0.00                       & 81.6                        & 881.13                  & 0.00                       & 64.6                        & 881.13                  & 64.6                        & 535.90                               \\
  r5b                  & 120                  & 11                   & 976.45                      & 0.00                       & 65.5                        & 1027.24                 & 0.00                       & 74.3                        & 976.45                  & 65.5                        & 589.74                               \\
  r6b                  & 144                  & 13                   & \multicolumn{1}{l}{1317.47} & 0.00                       & 77.1                        & 1352.09                 & 0.00                       & 81.9                        & 1317.47                 & 77.1                        & 743.60                               \\
  \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{}        & \multicolumn{1}{l}{}       & \multicolumn{1}{l}{}        & \multicolumn{1}{l}{}    & \multicolumn{1}{l}{}       & \multicolumn{1}{l}{}        & \multicolumn{1}{l}{}    & \multicolumn{1}{l}{}        & \multicolumn{1}{l}{}                 \\
  平均                   & \multicolumn{1}{l}{} & \multicolumn{1}{l}{} & \multicolumn{1}{l}{}        & \multicolumn{1}{l}{}       & 51.8                        &                         &                            & 52.9                        &                         & 50.2                        &                                      \\ \hline
  \end{tabular}
  \end{table}
\end{landscape}


\begin{landscape}
  \begin{table}[]
  \caption{係数$\beta$を変化させた際の計算結果}
  \label{beta}
  \begin{tabular}{cllrrrrrrrr}
  \hline
  \multicolumn{1}{l}{} & \multicolumn{2}{c}{size}                          & \multicolumn{2}{c}{\beta=1}                               & \multicolumn{2}{c}{\beta=10}                              & \multicolumn{2}{c}{\beta=50}                              & \multicolumn{2}{c}{\beta=500}                             \\ \cline{2-11}
  問題例                  & \multicolumn{1}{r}{顧客数} & \multicolumn{1}{r}{車両数} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} \\ \cline{2-11}
  r1a                  & \multicolumn{1}{c}{24}  & \multicolumn{1}{c}{3}   & 202.19                        & 1.07                         & 208.99                       & 0.00                      & 208.99                        & 0.00                        & 212.49                        & 0.00                        \\
  r2a                  & \multicolumn{1}{c}{48}  & \multicolumn{1}{c}{5}   & 424.79                        & 1.67                        & 391.61                      & 0.02                        & 386.03                        & 0.00                        & 386.03                        & 0.0                         \\
  r3a                  & \multicolumn{1}{c}{72}  & \multicolumn{1}{c}{7}   & 708.97                        & 17.18                         & 803.64                        & 0.00                       & 763.27                        & 3.50                        & 776.31                        & 0.56                         \\
  r4a                  & \multicolumn{1}{c}{96}  & \multicolumn{1}{c}{9}   & 911.66                        & 14.99                      & 928.49                        & 0.00                        & 1005.17                       & 0.00                     & 1005.17                        & 0.00                        \\
  r5a                  & \multicolumn{1}{c}{120}  & \multicolumn{1}{c}{11}   & 1038.52                       & 19.37                      & 1094.43                        & 0.00                        & 1077.49                       & 0.00                        & 1077.68                        & 0.0                         \\
  r6a                  & \multicolumn{1}{c}{144}  & \multicolumn{1}{c}{13}   & 1350.81                       & 22.38                         & 1428.04                        & 49.88                        & 1494.52                        & 39.64                         & 1506.35                        & 9.56                         \\
  r1b                  & \multicolumn{1}{c}{24}  & \multicolumn{1}{c}{3}   & 200.74                       & 0.00                      & 197.48                       & 0.00                        & 203.61                        & 0.00                       & 195.6                        & 0.0
                           \\
  r2b                  & \multicolumn{1}{c}{48}  & \multicolumn{1}{c}{5}   & 403.99                        & 1.38                         & 398.94                        & 0.00                        & 386.47                        & 0.00                        & 388.43                        & 0.0                         \\
  r3b                  & \multicolumn{1}{c}{72}  & \multicolumn{1}{c}{7}   & 686.30                & 15.71                        & 752.70                        & 0.14                         & 777.09                        & 0.00                        & 777.09                        & 0.0                         \\
  r4b                  & \multicolumn{1}{c}{96}  & \multicolumn{1}{c}{9}   & 894.65                     & 3.70                    & 919.01                        & 0.00                        & 958.40                        & 0.24                         & 973.73                        & 0.0                         \\
  r5b                  & \multicolumn{1}{c}{120}  & \multicolumn{1}{c}{11}   & 964.83                      & 12.25                         & 1007.51                        & 0.00                       & 976.45                        & 0.00                        & 976.45                       & 0.0                         \\
  r6b                  & \multicolumn{1}{c}{144}  & \multicolumn{1}{c}{13}   & 1264.03                     & 22.45                        & 1297.15                       & 0.34                         & 1314.24                        & 0.00                        & 1317.47                        & 0.0                         \\
                       &                         &                         &                           &                           &                           &                           &                           &                           &                           &                           \\
  average              &                         &                         & 754.29                        & 11.01                         & 785.66                         & 4.19                         & 795.97                         & 3.615                         & 796.86                         & 0.84                        \\ \hline
  \end{tabular}
  \end{table}
\end{landscape}




% \begin{landscape}
\begin{table}[]
% \tabcolsep = 19pt
\renewcommand{\arraystretch}{0.8}
\caption{車両数を減らした際の比較}
\label{m-1}
\begin{tabular}{cl|lll|lll}
\hline
                            & \multicolumn{1}{c|}{}    & \multicolumn{3}{c|}{台数に変化なし}                                               & \multicolumn{3}{c}{1台削除}                                                \\ \hline
問題例                          & \multicolumn{1}{c|}{顧客数} & \multicolumn{1}{c}{車両数} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c|}{ペナルティ値} & \multicolumn{1}{c}{車両数} & \multicolumn{1}{c}{最良値} & \multicolumn{1}{c}{ペナルティ値} \\ \hline
r1a                         & \multicolumn{1}{r|}{24}  & \multicolumn{1}{r}{3} & \multicolumn{1}{r}{202.19} & \multicolumn{1}{r|}{1.07}  & \multicolumn{1}{r}{2} & \multicolumn{1}{r}{235.23} & \multicolumn{1}{r}{0.44}  \\
r2a                         & \multicolumn{1}{r|}{48}  & \multicolumn{1}{r}{5} & \multicolumn{1}{r}{424.79} & \multicolumn{1}{r|}{1.67}  & \multicolumn{1}{r}{4} & \multicolumn{1}{r}{390.20} & \multicolumn{1}{r}{13.08}  \\
r3a                         & \multicolumn{1}{r|}{72}  & \multicolumn{1}{r}{7} & \multicolumn{1}{r}{708.97} & \multicolumn{1}{r|}{17.18}  & \multicolumn{1}{r}{6} & \multicolumn{1}{r}{749.78} & \multicolumn{1}{r}{45.47}  \\
r4a                         & \multicolumn{1}{r|}{96}  & \multicolumn{1}{r}{9} & \multicolumn{1}{r}{911.66} & \multicolumn{1}{r|}{14.99}  & \multicolumn{1}{r}{8} & \multicolumn{1}{r}{955.01} & \multicolumn{1}{r}{23.95}  \\
r1b                       & \multicolumn{1}{r|}{24}  & \multicolumn{1}{r}{3} & \multicolumn{1}{r}{200.74} & \multicolumn{1}{r|}{0.00}  & \multicolumn{1}{r}{2} & \multicolumn{1}{r}{217.61} & \multicolumn{1}{r}{2.40}  \\
r2b                        & \multicolumn{1}{r|}{48}  & \multicolumn{1}{r}{5} & \multicolumn{1}{r}{403.99} & \multicolumn{1}{r|}{1.38}  & \multicolumn{1}{r}{4} & \multicolumn{1}{r}{377.78} & \multicolumn{1}{r}{11.46}  \\
r3b                           & \multicolumn{1}{r|}{72}  & \multicolumn{1}{r}{7} & \multicolumn{1}{r}{686.30} & \multicolumn{1}{r|}{15.71}  & \multicolumn{1}{r}{6} & \multicolumn{1}{r}{707.90} & \multicolumn{1}{r}{27.26}  \\
r4b                         & \multicolumn{1}{r|}{96}  & \multicolumn{1}{r}{9} & \multicolumn{1}{r}{894.65} & \multicolumn{1}{r|}{3.70}  & \multicolumn{1}{r}{8} & \multicolumn{1}{r}{831.89} & \multicolumn{1}{r}{30.48}  \\ \hline
\end{tabular}
\end{table}
% \end{landscape}


% \begin{table}[htbp]
%  \centering
%  \tabcolsep = 40pt
%  \renewcommand{\arraystretch}{0.8}
%  \caption{表の表示例}
%  \label{table12}
%  \begin{tabular}{lrr} \hline
%   問題例 & 挿入近傍 & 計算時間（秒)& 挿入近傍 & 計算時間（秒) \\ \hline
%   instance\_24\_3 &    123 & 10.1 \\
%   c10100 &    456 & 15.2 \\
%   c20100 &    789 & 20.3 \\ \hline
%  \end{tabular}
% \end{table}


% \begin{table*}
%  \centering
%  \tabcolsep = 19pt
%  \renewcommand{\arraystretch}{0.8}
%  \caption{2段組みスタイルにおいて幅の広い表を表示する例}
%  \label{table2}
%  \begin{tabular}{lrrcrr} \hline
%   &\multicolumn{2}{c}{既存手法} && \multicolumn{2}{c}{提案手法}\\ \cline{2-3} \cline{5-6}
%
%   問題例 & 最良値 & 計算時間（秒）&& 最良値 & 計算時間（秒） \\ \hline
%   c05100 &    123 &          10.1 &&    111 &          10.00\\
%   c10100 &    456 &          15.2 &&    432 &          15.0 \\
%   c20100 &    789 &          20.3 &&    765 &          20.00\\ \hline
%  \end{tabular}
% \end{table*}
